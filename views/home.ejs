<link rel="stylesheet" href="/css/home.css" />
<h1><%= title %></h1>

<section id="feed-posts">
  <h4>Posts</h4>
  <%if(locals.user){%>
  <form action="/posts/create" id="new-post-form" method="post">
    <textarea
      name="content"
      id="new-post"
      cols="30"
      rows="3"
      placeholder="Type Here..."
      required
    ></textarea>
    <input type="submit" value="Post" />
  </form>
  <%}%>
  <div id="posts-list-container">
    <ul>
      <%for( post of posts){ %>
      <li>
        <h6><%= post.user.name %></h6>
        <p><%= post.content %></p>
        <%if(locals.user && locals.user.id == post.user.id){%>
        <button><a href="/posts/destroy/<%=post._id%>">Delete</a></button>
        <%}%>
        <div id="post-comment">
          <%if(locals.user){%>
          <form action="/comments/create/" method="post">
            <h6>Add Comment</h6>
            <input type="text" name="comment" id="comment" placeholder="type here..." required/>
            <input type="hidden" name="post" value="<%= post._id %>">
            <button type="submit">Add</button>
          </form>
          <%}%>

          <div class="post-comments-list">
            <ul id="post-comments-<%= post._id%>">
              
              <% for ( comment of post.comments){%>
                <li>
                <small><%= comment.user.name%></small>
                <p><%= comment.comment %></p>
                <%if(locals.user && locals.user.id == comment.user.id){%>
                  <button><a href="/comments/destroy/<%=comment._id%>">Delete</a></button>
                  <%}%>
                </li>
                <%}%>
            </ul>
          </div>
        </div>
        
      </li>
      <%}%>
    </ul>
  </div>
</section>
